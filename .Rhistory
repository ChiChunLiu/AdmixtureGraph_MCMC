trait1 = sim(c(0.3, 0, -0.4), gt)
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1 = sim(c(0.3, 0, -0.4), gt)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
# STEP4:
trait1_susie = susie(gt, trait1)
trait2_susie = susie(gt, trait2)
susie_get_pip(trait1_susie)
susie_get_cs(trait1_susie)
help("susie_get_cs")
susie_get_cs(trait1_susie, coverage = 0.95,
min_abs_corr = 0.5,)
susie_get_cs(trait1_susie, coverage = 0.95,
min_abs_corr = 0.5)
# STEP 3: run gwas
run_gwas(gt, trait1)
# STEP 3: run gwas
z_trait1 = run_gwas(gt, trait1)
# STEP 3: run gwas
z_trait1 = fastlm(gt, trait1)
z_trait1
gt
gt = load_genotype('../pset4/genotype.raw')
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
gt
gt = load_genotype('../pset4/genotype.raw')
gt
# STEP 3: run gwas
z_trait1 = fastlm(gt, trait1)
z_trait1
gt
dim(gt)
trait1
run_gwas = function(X, y) {
# input:
#   X: a genotype matrix where each row is for one individual and each column is for one variant
#   y: a vector of phenotype where each entry is for one individual
# return:
#   a vector of z-score where the ith entry is for testing association between Y and ith column of X
pvec = rep(NA, ncol(X))
bvec = rep(NA, ncol(X))
for(ss in 1 : ncol(X))
{
fit = fastlm(X[,ss], y)
pvec[ss] = fit$pval
bvec[ss] = fit$betahat
}
return(pvec)
}
# STEP 3: run gwas
z_trait1 = run_gwas(gt, trait1)
z_trait1
run_gwas = function(X, y) {
# input:
#   X: a genotype matrix where each row is for one individual and each column is for one variant
#   y: a vector of phenotype where each entry is for one individual
# return:
#   a vector of z-score where the ith entry is for testing association between Y and ith column of X
pvec = rep(NA, ncol(X))
bvec = rep(NA, ncol(X))
for(ss in 1 : ncol(X))
{
fit = fastlm(X[,ss], y)
pvec[ss] = fit$pval
bvec[ss] = fit$betahat
}
return(list(p2z(bvec, pvec),pvec))
}
# STEP 3: run gwas
p_trait1 = run_gwas(gt, trait1)
p_trait1
#devtools::install_github("stephenslab/susieR@0.9.0",build_vignettes = TRUE)
source('../pset4/rlib.R')
library(susieR)
set.seed(1333)
gt = load_genotype('../pset4/genotype.raw')
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
# STEP 3: run gwas
gwas_trait1 = run_gwas(gt, trait1)
gwas_trait2 = run_gwas(gt, trait2)
# STEP4:
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
trait1_cs = susie_get_cs(trait1_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait1_susie, y="PIP", b=b)
#devtools::install_github("stephenslab/susieR@0.9.0",build_vignettes = TRUE)
source('../pset4/rlib.R')
library(susieR)
set.seed(1333)
gt = load_genotype('../pset4/genotype.raw')
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
# STEP 3: run gwas
gwas_trait1 = run_gwas(gt, trait1)
gwas_trait2 = run_gwas(gt, trait2)
# STEP4:
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
trait1_cs = susie_get_cs(trait1_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait1_susie, y="PIP", b=b)
#devtools::install_github("stephenslab/susieR@0.9.0",build_vignettes = TRUE)
source('../pset4/rlib.R')
library(susieR)
set.seed(1333)
gt = load_genotype('../pset4/genotype.raw')
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
# STEP 3: run gwas
gwas_trait1 = run_gwas(gt, trait1)
gwas_trait2 = run_gwas(gt, trait2)
# STEP4:
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
trait1_cs = susie_get_cs(trait1_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait1_susie, y="PIP")
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
trait2_cs = susie_get_cs(trait2_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait2_susie, y="PIP")
trait1_susie
help(susie_plot)
b.
names(gt)
gt
names(as.data.frame(gt))
# STEP4:
b = rep(0, ncol(gt))
b[which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))] = 1
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
trait1_cs = susie_get_cs(trait1_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait1_susie, y="PIP", b = b)
#devtools::install_github("stephenslab/susieR@0.9.0",build_vignettes = TRUE)
source('../pset4/rlib.R')
library(susieR)
set.seed(1333)
gt = load_genotype('../pset4/genotype.raw')
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1_susie
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
# STEP 3: run gwas
gwas_trait1 = run_gwas(gt, trait1)
gwas_trait2 = run_gwas(gt, trait2)
# STEP4:
b = rep(0, ncol(gt))
b[which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))] = 1
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
trait1_cs = susie_get_cs(trait1_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait1_susie, y="PIP", b = b)
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
trait2_cs = susie_get_cs(trait2_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait2_susie, y="PIP")
#devtools::install_github("stephenslab/susieR@0.9.0",build_vignettes = TRUE)
source('../pset4/rlib.R')
library(susieR)
set.seed(123)
gt = load_genotype('../pset4/genotype.raw')
# STEP 1: standardize the genotype
gt = scale(gt, center = T, scale = T)
# STEP 2: simulate phenotypes
sim <- function(beta_causal, gt){
n = dim(gt)[1]
# simulate a gwas given a causal effect size
Y = gt$rs62103701_G * beta_causal[1] +
gt$rs57360893_G * beta_causal[2] +
gt$rs72984464_T * beta_causal[3] +
rnorm(n)
}
trait1_susie
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
# STEP 3: run gwas
gwas_trait1 = run_gwas(gt, trait1)
gwas_trait2 = run_gwas(gt, trait2)
# STEP4:
b = rep(0, ncol(gt))
b[which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))] = 1
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
trait1_cs = susie_get_cs(trait1_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait1_susie, y="PIP", b = b)
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
trait2_cs = susie_get_cs(trait2_susie,
coverage = 0.95,
min_abs_corr = 0.5)
susie_plot(trait2_susie, y="PIP", b = b)
source('rlib6.R')
pi1 = 1/ncol(gt)
pi2 = pi1
simulate_coloc <- function(gt, alpha, pi1 = pi1, pi2 = pi2){
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
gt
class(gt)
names(gt)
row.names(gt)
gt$names
pi1
simulate_coloc(gt, 0.5)
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
pip1
pip2
coloc_prob(pip1, pip2, pi1, pi2, 0.1)
coloc_prob(pip1, pip2, pi1, pi2, 0.2)
coloc_prob(pip1, pip2, pi1, pi2, 0.3)
coloc_prob(pip1, pip2, pi1, pi2, 0.5)
source('rlib6.R')
pi1 = 1/ncol(gt)
pi2 = pi1
simulate_coloc <- function(gt, alpha, pi1 = pi1, pi2 = pi2){
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc(gt, 0.5)
source('rlib6.R')
pi1 = 1/ncol(gt)
pi2 = pi1
simulate_coloc <- function(gt, alpha, pi1 = pi1, pi2 = pi2){
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc(gt, 0.1)
simulate_coloc(gt, 0.1)
simulate_coloc(gt, 0.2)
pi1
pi2
source('rlib6.R')
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
print(pi1)
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc(gt, 0.1)
source('rlib6.R')
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
print(pi1)
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc(gt, 0.1)
source('rlib6.R')
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
print(pi1)
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc_all_alpha <- function() sapply(seq(0.01, 0.99, by = 0.01), function(x) simulate_coloc(gt, x))
dd = lapply(1:50, function(x) simulate_coloc_all_alpha)
dd
source('rlib6.R')
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
print(pi1)
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc_all_alpha <- function() sapply(seq(0.01, 0.99, by = 0.01), function(x) simulate_coloc(gt, x))
dd = lapply(1:50, simulate_coloc_all_alpha)
source('rlib6.R')
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
print(pi1)
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc_all_alpha <- function() sapply(seq(0.01, 0.99, by = 0.01), function(x) simulate_coloc(gt, x))
dd = lapply(1:50, simulate_coloc_all_alpha())
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc_all_alpha <- function() sapply(seq(0.01, 0.99, by = 0.01), function(x) simulate_coloc(gt, x))
out = lapply(1:50, simulate_coloc_all_alpha())
simulate_coloc_all_alpha())
simulate_coloc_all_alpha()
out = lapply(1:3, function(x) simulate_coloc_all_alpha())
out
source('rlib6.R')
pi = 1/ncol(gt)
simulate_coloc <- function(gt, alpha, pi1 = pi, pi2 = pi){
trait1 = sim(c(0.3, 0, -0.4), as.data.frame(gt))
trait2 = sim(c(-0.3, 0.4, 0), as.data.frame(gt))
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
trait1_susie = susie(gt, trait1)
trait1_pip = susie_get_pip(trait1_susie)
pip1 = trait1_pip[causal_index]
trait2_susie = susie(gt, trait2)
trait2_pip = susie_get_pip(trait2_susie)
pip2 = trait2_pip[causal_index]
coloc_prob(pip1, pip2, pi1, pi2, alpha)
}
simulate_coloc_all_alpha <- function() sapply(seq(0.01, 0.99, by = 0.01), function(x) simulate_coloc(gt, x))
out = lapply(1:50, function(x) simulate_coloc_all_alpha())
alphas = seq(0.01, 0.99, by = 0.01)
plot(alphas, out[[1]][1,], type = l, col = 'green')
alphas = seq(0.01, 0.99, by = 0.01)
plot(alphas, out[[1]][1,], type = 'l', col = 'green')
lines(alphas, out[[1]][1,], type = 'l', col = 'blue')
plot(alphas, out[[1]][1,], type = 'l', col = 'green')
lines(alphas, out[[1]][2,], col = 'blue')
out[[1]][2,]
plot(alphas, out[[1]][1,], type = 'l', col = 'green')
line(alphas, out[[1]][2,], col = 'blue')
lines(alphas, out[[1]][2,], col = 'blue')
help(lines)
plot(alphas, out[[1]][1,], type = 'l', col = 'green')
lines(alphas, out[[1]][2,], col = 'blue')
alphas = seq(0.01, 0.99, by = 0.01)
plot(alphas, out[[1]][1,], type = 'l', col = 'green')
lines(alphas, out[[1]][2,], col = 'blue')
lines(alphas, out[[1]][3,], col = 'red')
alphas = seq(0.01, 0.99, by = 0.01)
plot(alphas, out[[1]][1,], type = 'l', col = 'green', ylim = c(0, 1))
lines(alphas, out[[1]][2,], col = 'blue')
lines(alphas, out[[1]][3,], col = 'red')
alphas = seq(0.01, 0.99, by = 0.01)
plot(alphas, out[[1]][1,], type = 'l', col = 'green', ylim = c(0, 1))
lines(alphas, out[[1]][2,], col = 'blue')
lines(alphas, out[[1]][3,], col = 'red')
for (i in 2:50){
lines(alphas, out[[i]][1,], col = 'green')
lines(alphas, out[[i]][2,], col = 'blue')
lines(alphas, out[[i]][3,], col = 'red')
}
out
out[[1]]
simulate_coloc(gt, 0.9)
causal_index = which(names(as.data.frame(gt)) %in% c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
causal_index
names(as.data.frame(gt)[causal_index]
names(as.data.frame(gt))[causal_index]
help("match")
match(names(as.data.frame(gt)), c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
causal_index = match(names(as.data.frame(gt)), c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
which(causal_index == 1)
causal_index = c(which(causal_index == 1), which(causal_index == 2), which(causal_index == 3))
causal_index
causal_index = match(names(as.data.frame(gt)), c('rs62103701_G', 'rs57360893_G', 'rs72984464_T'))
causal_index = c(which(causal_index == 1), which(causal_index == 2), which(causal_index == 3))
causal_index
source('rlib6.R')
pi = 1/ncol(gt)
